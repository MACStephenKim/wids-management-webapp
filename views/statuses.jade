extends layout

block content
    div(ng-app="angularstatuses")
        div(ng-controller="statusesController")
            a(ng-show='logged', href='/login')
                |  Log In
            a(ng-show='loggedout', href='/logout')
                |  Log Out
            | &nbsp;
            | &nbsp;
            | &nbsp;
            | &nbsp;
            | &nbsp;
            | &nbsp;
            | &nbsp;
            | &nbsp;
            | &nbsp;
            | &nbsp;
            | &nbsp;
            | &nbsp;
            | &nbsp;
            | &nbsp;
            | &nbsp;
            | &nbsp;
            | &nbsp;
            | &nbsp;
            | &nbsp;
            | &nbsp;
            | &nbsp;
            | &nbsp;
            | &nbsp;
            | &nbsp;
            | &nbsp;
            | &nbsp;
            | &nbsp;
            | &nbsp;
            | &nbsp;
            | &nbsp;
            | &nbsp;
            | &nbsp;
            | &nbsp;
            | &nbsp;
            | &nbsp;
            | &nbsp;
            | &nbsp;
            | &nbsp;
            | &nbsp;
            | &nbsp;
            | &nbsp;
            | &nbsp;
            | &nbsp;
            | &nbsp;
            | &nbsp;
            | &nbsp;
            | &nbsp;
            | &nbsp;
            | &nbsp;
            | &nbsp;
            | &nbsp;
            | &nbsp;
            | &nbsp;
            | &nbsp;
            | &nbsp;
            | &nbsp;
            | &nbsp;
            | &nbsp;
            | &nbsp;
            | &nbsp;
            | &nbsp;
            | &nbsp;
            | &nbsp;
            | &nbsp;
            | &nbsp;
            | &nbsp;
            | &nbsp;
            | &nbsp;
            | &nbsp;
            | &nbsp;
            | &nbsp;
            | &nbsp;
            | &nbsp;
            | &nbsp;
            | &nbsp;
            | &nbsp;
            | &nbsp;
            | &nbsp;
            | &nbsp;
            | &nbsp;
            | &nbsp;
            | &nbsp;
            | &nbsp;
            | &nbsp;
            | &nbsp;
            | &nbsp;
            | &nbsp;
            | &nbsp;
            | &nbsp;
            | &nbsp;
            | &nbsp;
            | &nbsp;
            | &nbsp;
            | &nbsp;
            | &nbsp;
            | &nbsp;
            | &nbsp;
            | &nbsp;
            | &nbsp;
            | &nbsp;
            | &nbsp;
            | &nbsp;
            | &nbsp;
            | &nbsp;
            if isAuthenticated
                if (typeof(newmessage) === 'undefined')
                    | Welcome user:
                    | &nbsp;
                    = username
            if (typeof(newmessage) !== 'undefined')
                | #{newmessage}
            nav.navbar.navbar-toggleable-md.navbar-light.bg-faded
                #navbarSupportedContent.collapse.navbar-collapse
                    ul.nav.nav-tabs
                        li.nav-item
                            a.nav-link(href='/')
                                |  Home
                        li.nav-item
                            a.nav-link(href='/restrooms')
                                |  Restrooms
                        li.nav-item.active   
                            a.nav-link(href='/statuses')
                                |  Statuses
                        li.nav-item
                            a.nav-link(href='/headcounts')
                                |  Headcounts
                        li.nav-item
                            a.nav-link(href='/actions')
                                |  Actions
            //Add icon
            a.plus(ng-show='showadd', tooltip='Add more', ng-click='showForm = true; showdelete = false', href='javascript:void(0);', ng-model='skm')
                i.icon-plus
                | + ADD 

            //Search icon
            a.search(tooltip='Add more', ng-click='showSearch = true; removesearch = true', href='javascript:void(0);', ng-model='skm')
                span.glyphicon.glyphicon-search
            // FORM TO CREATE Status
            #todo-form.row
                form.form-group(ng-show='showForm', name="addForm", role='form', novalidate)
                    // BIND THIS VALUE TO formData IN ANGULAR
                    label Inbound Timestamp
                        | &nbsp;
                        label(ng-class='{red : true}') 
                            |*
                    br
                    input(type='datetime-local', name='timestamp', ng-model='formData.inbound_timestamp', required)
                    .custom-error(ng-show='addForm.timestamp.$dirty && addForm.timestamp.$invalid') Invalid: Inbound Timestamp is required. 
                    br
                    br 
                    label Inbound Message
                        | &nbsp;
                        label(ng-class='{red : true}') 
                            |*
                    input.form-control.input-lg(type='text', name='message', ng-model='formData.inbound_message', placeholder='Message', required)
                    .custom-error(ng-show='addForm.message.$dirty && addForm.message.$invalid') Invalid: 
                        span(ng-show='addForm.message.$error.required') Inbound Message is required.  
                    label Door Number
                        | &nbsp;
                        label(ng-class='{red : true}') 
                            |*
                    input.form-control.input-lg(type='text', name='door', ng-model='formData.door_number', placeholder='Door number', required)
                    .custom-error(ng-show='addForm.door.$dirty && addForm.door.$invalid') Invalid: 
                        span(ng-show='addForm.door.$error.required') Door Number is required. 
                    label Status
                        | &nbsp;
                        label(ng-class='{red : true}') 
                            |*
                    input.form-control.input-lg(type='text', name='status', ng-model='formData.status', placeholder='Status', required)
                    .custom-error(ng-show='addForm.status.$dirty && addForm.status.$invalid') Invalid: 
                        span(ng-show='addForm.status.$error.required') Status is required. 
                    label Update User
                        | &nbsp;
                        label(ng-class='{red : true}') 
                            |*
                    input.form-control.input-lg(type='text', name='user', ng-model='formData.update_user', placeholder='User', required)
                    .custom-error(ng-show='addForm.user.$dirty && addForm.user.$invalid') Invalid: 
                        span(ng-show='addForm.user.$error.required') Update User is required. 
                    
                    // createstatus() WILL CREATE NEW status
                    button.btn.btn-primary.btn-lg(type='submit', ng-click='createStatus()', ng-disabled='addForm.timestamp.$dirty && addForm.timestamp.$invalid || addForm.message.$pristine || addForm.message.$dirty && addForm.message.$invalid || addForm.door.$pristine || addForm.door.$dirty && addForm.door.$invalid || addForm.status.$pristine || addForm.status.$dirty && addForm.status.$invalid || addForm.user.$pristine || addForm.user.$dirty && addForm.user.$invalid') Add
                    button.btn.btn-primary.btn-lg(type='submit', ng-click='cancelStatus()') Cancel
            
            // FORM TO Update Status
            #todo-form.row
                form.form-group(ng-show='IsVisible', name='updateForm', role='form', novalidate)
                    // BIND THIS VALUE TO formData IN ANGULAR
                    label Inbound Timestamp
                        | &nbsp;
                        label(ng-class='{red : true}') 
                            |*
                    br
                    input(type='datetime-local', name='timestamp', ng-model='formupData.inbound_timestamp', required)
                    .custom-error(ng-show='updateForm.timestamp.$dirty && updateForm.timestamp.$invalid') Invalid: Inbound Timestamp is required.  
                    br
                    br 
                    label Inbound Message
                        | &nbsp;
                        label(ng-class='{red : true}') 
                            |*
                    input.form-control.input-lg(type='text', name='message', ng-model='formupData.inbound_message', required)
                    .custom-error(ng-show='updateForm.message.$dirty && updateForm.message.$invalid') Invalid: 
                        span(ng-show='updateForm.message.$error.required') Inbound Message is required. 
                    label Door Number
                        | &nbsp;
                        label(ng-class='{red : true}') 
                            |*
                    input.form-control.input-lg(type='text', name='door', ng-model='formupData.door_number', required)
                    .custom-error(ng-show='updateForm.door.$dirty && updateForm.door.$invalid') Invalid: 
                        span(ng-show='updateForm.door.$error.required') Door Number is required.
                    label Status
                        | &nbsp;
                        label(ng-class='{red : true}') 
                            |*
                    input.form-control.input-lg(type='text', name='status', ng-model='formupData.status', required)
                    .custom-error(ng-show='updateForm.status.$dirty && updateForm.status.$invalid') Invalid: 
                        span(ng-show='updateForm.status.$error.required') Status is required. 
                    label Update User
                        | &nbsp;
                        label(ng-class='{red : true}') 
                            |*
                    input.form-control.input-lg(type='text', name='user', ng-model='formupData.update_user', required)
                    .custom-error(ng-show='updateForm.user.$dirty && updateForm.user.$invalid') Invalid: 
                        span(ng-show='updateForm.user.$error.required') Update User is required. 
                    
                    // updatestatus() WILL UPDATE status
                    button.btn.btn-primary.btn-lg(type='submit', ng-click='updateStatus(formupData)', ng-disabled='updateForm.timestamp.$dirty && updateForm.timestamp.$invalid || updateForm.message.$dirty && updateForm.message.$invalid || updateForm.door.$dirty && updateForm.door.$invalid || updateForm.status.$dirty && updateForm.status.$invalid || updateForm.user.$dirty && updateForm.user.$invalid') Update
                    button.btn.btn-primary.btn-lg(type='submit', ng-click='cancelupdateStatus()') Cancel
            br
            #restroomList
                div
                    label(ng-show='showSearch')
                        | Search
                        | &nbsp;
                        input(ng-model='searchKeyword')
                        | &nbsp;
                        a#search(ng-show='removesearch', tooltip='Add more', ng-click='showSearch = false; removeserach = false; searchClear()', href='javascript:void(0);', ng-model='skm')
                            i.icon-plus
                            | X
                // /SEARCH CONTAINER
                table
                    thead
                        tr
                            th
                                a(href='#', ng-click="orderByField='status_id'; reverseSort = !reverseSort")
                                            | Status ID
                                            span(ng-show="orderByField == 'status_id'")
                                                span.glyphicon.glyphicon-arrow-up(ng-show='!reverseSort')
                                                span.glyphicon.glyphicon-arrow-down(ng-show='reverseSort')
                            th 
                                a(href='#', ng-click="orderByField='display_status'; reverseSort = !reverseSort")
                                            | Status
                                            span(ng-show="orderByField == 'display_status'")
                                                span.glyphicon.glyphicon-arrow-up(ng-show='!reverseSort')
                                                span.glyphicon.glyphicon-arrow-down(ng-show='reverseSort')
                            //- th Display Status
                            //- th Current Status
                            th 
                                a(href='#', ng-click="orderByField='door_number'; reverseSort = !reverseSort")
                                            | Door Number
                                            span(ng-show="orderByField == 'door_number'")
                                                span.glyphicon.glyphicon-arrow-up(ng-show='!reverseSort')
                                                span.glyphicon.glyphicon-arrow-down(ng-show='reverseSort')
                            th
                                a(href='#', ng-click="orderByField='update_date'; reverseSort = !reverseSort")
                                            | Update Date
                                            span(ng-show="orderByField == 'update_date'")
                                                span.glyphicon.glyphicon-arrow-up(ng-show='!reverseSort')
                                                span.glyphicon.glyphicon-arrow-down(ng-show='reverseSort')
                            th 
                                a(href='#', ng-click="orderByField='inbound_timestamp'; reverseSort = !reverseSort")
                                            | Inbound Timestamp
                                            span(ng-show="orderByField == 'inbound_timestamp'")
                                                span.glyphicon.glyphicon-arrow-up(ng-show='!reverseSort')
                                                span.glyphicon.glyphicon-arrow-down(ng-show='reverseSort')
                            th 
                                a(href='#', ng-click="orderByField='inbound_message'; reverseSort = !reverseSort")
                                            | Inbound Message
                                            span(ng-show="orderByField == 'inbound_message'")
                                                span.glyphicon.glyphicon-arrow-up(ng-show='!reverseSort')
                                                span.glyphicon.glyphicon-arrow-down(ng-show='reverseSort')
                            th 
                                a(href='#', ng-click="orderByField='update_user'; reverseSort = !reverseSort")
                                            | Update User
                                            span(ng-show="orderByField == 'update_user'")
                                                span.glyphicon.glyphicon-arrow-up(ng-show='!reverseSort')
                                                span.glyphicon.glyphicon-arrow-down(ng-show='reverseSort')
                            th(ng-show='showdelete') Update/Delete
                    
                    tbody
                        tr(ng-repeat='item in status = (statuses | filter: searchKeyword) | orderBy:[orderByField]:reverseSort | startFrom:(currentPage-1)*itemsPerPage | limitTo:itemsPerPage')
                            td 
                                {{item.status_id}}
                            td
                                {{item.display_status}}
                            //- td
                            //-     {{item.display_status}}
                            //- td
                            //-     {{item.current_status}}
                            td
                                {{item.door_number}}
                            td
                                {{item.update_date}}
                            td
                                {{item.inbound_timestamp}}
                            td
                                {{item.inbound_message}}
                            td
                                {{item.update_user}}
                            td(ng-show='showdelete')
                                a(href='#', ng-click='populateFields(item)')
                                    span.glyphicon.glyphicon-pencil
                                | &nbsp;
                                | &nbsp;  
                                a.paint(ng-click='deleteStatus(item)', ng-model="item.isChecked" , tooltip='Add more', href='javascript:void(0);')
                                    i.icon-plus
                                    | X

                //Pagination
                | View 
                select(ng-model='viewby', name='amount', ng-change='setItemsPerPage(viewby)')
                    option 3
                    option 5
                    option(value='10',name='amount') 10
                    option 20
                    option 30
                    option 40
                    option 50
                |   records at a time.
                uib-pagination(total-items='status.length', ng-model='currentPage', boundary-link-numbers="true", items-per-page='itemsPerPage', boundary-links="true", max-size=5, rotate="true", num-pages='numPages')
            // /RESTROOM LIST     
block scripts
    link(rel='stylesheet', href='//maxcdn.bootstrapcdn.com/bootstrap/3.3.7/css/bootstrap.min.css')

    link(data-require='bootstrap-css@*', data-semver='4.0.0-alpha.2', rel='stylesheet', href='https://maxcdn.bootstrapcdn.com/bootstrap/4.0.0-alpha.2/css/bootstrap.min.css')
    script.
      document.write('<base href="' + document.location + '" />');
    //- script(data-require='angular.js@1.4.x', src='https://code.angularjs.org/1.4.9/angular.js', data-semver='1.4.9')
    //- script(data-require='ui-bootstrap@*', data-semver='1.3.2', src='https://cdn.rawgit.com/angular-ui/bootstrap/gh-pages/ui-bootstrap-tpls-1.3.2.js')

    script(data-require='angular.js@1.4.x', src='dist/js/vendor.min.js', data-semver='1.4.9')
    script(data-require='ui-bootstrap@*', data-semver='1.3.2', src='dist/js/vendor.min.js')

    //- script(src='http://ajax.googleapis.com/ajax/libs/angularjs/1.4.8/angular.min.js')
    //- script(src='http://ui-grid.info/release/ui-grid.js')    //- link(rel='stylesheet', href='http://ui-grid.info/release/ui-grid.css', type='text/css')

    //- script(src="//ajax.googleapis.com/ajax/libs/angularjs/1.4.5/angular.min.js")
    //- script(src="//ajax.googleapis.com/ajax/libs/jquery/1.12.4/jquery.min.js")
    //- script(src="//maxcdn.bootstrapcdn.com/bootstrap/3.3.7/js/bootstrap.min.js")
    //- script(src="dist/js/vendor.js")
    //- script(src="javascripts/app/statusapp.js")
    script(src="dist/js/bundle.min.js")